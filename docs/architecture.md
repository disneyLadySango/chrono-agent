# アーキテクチャ

## 概要

Chrono Agent は、複数の専門エージェントが Supabase をハブとして連携する分散型アーキテクチャを採用。

```
┌─────────────────────────────────────────────────────────────┐
│                        Tauri App                            │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                    Next.js (Frontend)                 │  │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  │  │
│  │  │  Tasks  │  │Schedule │  │ Timer   │  │Settings │  │  │
│  │  │  View   │  │  View   │  │  View   │  │  View   │  │  │
│  │  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘  │  │
│  │       └────────────┴────────────┴────────────┘       │  │
│  │                         │                             │  │
│  │              ┌──────────▼──────────┐                  │  │
│  │              │   VoltAgent Core    │                  │  │
│  │              │   (Orchestrator)    │                  │  │
│  │              └──────────┬──────────┘                  │  │
│  └─────────────────────────┼─────────────────────────────┘  │
└─────────────────────────────┼─────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│   Collector   │   │    Refiner    │   │    Planner    │
│   Agent       │   │    Agent      │   │    Agent      │
└───────┬───────┘   └───────┬───────┘   └───────┬───────┘
        │                   │                   │
        └───────────────────┼───────────────────┘
                            │
                            ▼
                ┌───────────────────────┐
                │       Supabase        │
                │  ┌─────────────────┐  │
                │  │   PostgreSQL    │  │
                │  │   + pgvector    │  │
                │  └─────────────────┘  │
                │  ┌─────────────────┐  │
                │  │  Edge Functions │  │
                │  └─────────────────┘  │
                └───────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
        ▼                   ▼                   ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│    Linear     │   │     JIRA      │   │Google Calendar│
└───────────────┘   └───────────────┘   └───────────────┘
```

## エージェント詳細

### Orchestrator（指揮官）

ユーザーからの依頼を解釈し、適切なエージェントを呼び出す。

- 入力: ユーザーの自然言語リクエスト
- 出力: エージェント呼び出しの判断・結果の統合

### Collector（収集）

外部サービスからタスクを収集し、Supabase に同期。

- 対応サービス: Linear, JIRA, Google Calendar
- 同期頻度: 定期実行 or Webhook

### Refiner（解像度向上）

曖昧なタスクを具体的なアクションに分解。

- RAG による過去ログ・Notion 参照
- pgvector によるセマンティック検索

### Planner（計画）

タスクをポモドーロ単位でスケジューリング。

- カレンダーの空き時間を考慮
- 優先度・締め切りに基づく最適化

### Tracker（実行）

ポモドーロタイマーと連動し、進捗を記録。

- リアルタイム進捗追跡
- フィードバック収集（AIの学習用）

## データフロー

1. **収集**: Collector が外部サービスからタスクを取得 → `tasks` テーブルに保存
2. **具体化**: Refiner が曖昧なタスクを分解 → タスクの詳細を更新
3. **計画**: Planner がスケジュールを生成 → `daily_schedules` テーブルに保存
4. **実行**: Tracker がポモドーロを記録 → `pomodoro_logs` テーブルに保存
5. **フィードバック**: ユーザーのフィードバックを学習に活用
